%THIS ONE IS NEWer 11/27/21
clc
clear
nano=1e-9;
Rdw=2000;
Rp=500;
Rap=4*Rp;
L=1e-7;
Ml=0.4*L;
Mr=0.6*L;
V=0.25;
W=0.01;
NegR=0; % Was 1 on original calculations
LSyn=-5;
LNode=0.2;
k=(2.1*0.7*9.274e-24)/(2*1.602e-19*800e3) * (1/(10e-9*5e-9));

N =100;
Dc=(-LSyn/k)*((N-1)*((Rap+Rp)/2)+Rdw);

R=(Rp+Rap)/2;

tFull=L/(k*((1/(N-1)*(V/(NegR+(Rdw/(N-1))))))+LNode);

VMin=0.02;
%VMax=0.39;
VMax=0.3;
VDelta=0.02;


WMin=0.1; %0.05
%WMax=VMax-0.01;
WMax=0.1;
WDelta=0.01;
z = NaN(round((VMax-VMin)/VDelta+1),round((WMax-WMin)/WDelta+1));
x=[VMin:VDelta:VMax];
y=[WMin:WDelta:WMax];
%sTs=[133.9719999998185  175.64799999927135  179.71099999921802  228.67499999857517  231.60099999853674  246.78299999833743  379.5999999965937  385.2419999965196  557.2319999985176  919.6910000129473];
sTs=[56.000000000005635 69.84900000000711 70.48700000000717 56.000000000005635 56.000000000005635 71.13600000000724 72.55700000000739 70.37400000000716 70.15300000000714 72.46700000000739 72.88500000000742 70.09200000000713 72.51000000000738 72.55700000000739 78.297000000008 70.41100000000716 70.06000000000712 70.62000000000718 72.55700000000739 72.46700000000739 73.09800000000745 70.49500000000717 71.28500000000726 70.36400000000715 72.11000000000735 70.7250000000072 70.12600000000714 72.6080000000074 75.15700000000767 70.92100000000721 72.46700000000739 76.46000000000781 76.26700000000778 70.35300000000716 70.7710000000072 70.67900000000719 70.25300000000715 70.44700000000716 71.02300000000723 71.02300000000723 72.09400000000734 70.20000000000714 70.8030000000072 70.7430000000072 72.55700000000739 75.31500000000769 70.7710000000072 71.28500000000726 70.81600000000721 72.90100000000743 75.4730000000077 77.74300000000794 76.65400000000783 72.51000000000738 71.26200000000725 70.64700000000718 70.64700000000718 70.52000000000717 70.85800000000721 72.18400000000734 70.37400000000716 70.48700000000717 69.92300000000711 70.64600000000719 70.41000000000716 70.52000000000717 56.000000000005635 70.7520000000072 71.26600000000725 72.80400000000742 70.7950000000072 72.55700000000739 74.4750000000076 69.92300000000711 70.64600000000719 83.86800000000859 69.97600000000712 72.28900000000736 70.69000000000719 70.23000000000714 72.51000000000738 56.000000000005635 72.41200000000738 70.41100000000716 72.19900000000736 74.4750000000076 70.7600000000072 72.37800000000738 71.94200000000733 71.77300000000731 72.18400000000734 74.20200000000756 81.60100000000836 72.37800000000738 70.42800000000716 70.39000000000716 72.55700000000739 72.99900000000744 73.83000000000753 72.55700000000739 76.63600000000783 70.56100000000718 71.05100000000724 70.49300000000717 71.10500000000724 71.04200000000723 71.47800000000727 71.28700000000725 73.5550000000075 73.94000000000754 75.75100000000774 77.24400000000789 78.96800000000808 70.49700000000718 70.7940000000072 72.58100000000739 71.78200000000732 70.70200000000719 71.57600000000728 74.79300000000762 74.64600000000762 71.6570000000073 70.87700000000721 70.83100000000721 73.50300000000749 73.16000000000746 71.22600000000725 73.50300000000749 71.09700000000724 74.64600000000762 73.61700000000751 75.23800000000767 73.50300000000749 79.2710000000081 74.06900000000755 72.5340000000074 70.67300000000719 73.42700000000748 70.81400000000721 74.93900000000764 80.50300000000823 71.03500000000723 70.49300000000717 70.59400000000718 70.7350000000072 70.80800000000721 72.74000000000741 73.50300000000749 73.61700000000751 79.47200000000812 72.48700000000738 73.38800000000748 81.88700000000838 77.55600000000793 71.74800000000731 73.50300000000749 73.73200000000752 77.25500000000788 77.3510000000079 72.36300000000737 79.04200000000807 73.61700000000751 73.61700000000751 71.50300000000728 71.03800000000723 70.49700000000718 73.94000000000754 75.75100000000774 76.98800000000786 74.19800000000757 74.06900000000755 77.12300000000788 70.82000000000721 73.16000000000746 71.09100000000724 71.50300000000728 70.62100000000719 71.05700000000724 73.73200000000752 81.70700000000836 73.04800000000745 70.88000000000721 74.06900000000755 71.51000000000728 70.94500000000723 72.58100000000739 72.01900000000734 70.7430000000072 73.15100000000746 77.3270000000079 74.4990000000076 70.61700000000718 70.98100000000723 79.54700000000813 73.94000000000754 74.06900000000755 73.42700000000748 70.7770000000072 75.92100000000775 76.94100000000786 70.90200000000722 70.7180000000072 71.53000000000728 71.36600000000726 71.23100000000726 73.21000000000745 71.94600000000733 73.10100000000745 72.99300000000744 75.15700000000767 75.4730000000077 81.67700000000836 71.39000000000726 85.20900000000873 73.46700000000749 73.7090000000075 72.99900000000744 73.95100000000754 75.89000000000775 81.83300000000837 86.21500000000884 73.7090000000075 70.7950000000072 71.86600000000732 74.99800000000765 71.11900000000723 83.71600000000858 79.14300000000809 76.26300000000778 71.20400000000724 86.55600000000888 74.06500000000754 78.25100000000799 85.34800000000874 73.34700000000747 83.23700000000852 73.7090000000075 78.43100000000801 83.0660000000085 90.76100000000932 90.6540000000093 72.80400000000742 71.45200000000727 72.09200000000735 73.34700000000747 70.95300000000722 71.08100000000724 70.7180000000072 72.5610000000074 73.10100000000745 71.7500000000073 79.21800000000809 70.96900000000723 73.31800000000747 78.80800000000805 71.73300000000731 73.21000000000745 78.94200000000806 79.00500000000807 81.79900000000836 82.9160000000085 71.43000000000727 71.23200000000725 71.24800000000725 72.50100000000738 73.21000000000745 71.12700000000724 78.24500000000799 71.94200000000733 72.77700000000742 76.26300000000778 77.83000000000796 86.61200000000888 79.41900000000811 78.43200000000802 70.7880000000072 70.92100000000721 72.98500000000743 72.45400000000738 78.04800000000797 78.62100000000804 71.07500000000724 80.21600000000821 76.07600000000777 71.24600000000726 83.51800000000856 73.34700000000747 72.28900000000736 74.36800000000758 73.95100000000754 77.4030000000079 73.10100000000745 73.95100000000754 81.27500000000832 73.10100000000745 73.5880000000075 71.11900000000723 74.99800000000765 79.2260000000081 88.50500000000908 99.1480000000102 71.31900000000726 73.61700000000751 76.66800000000782 76.69000000000783 71.77000000000731 80.41800000000822 73.15100000000746 73.94000000000754 74.35200000000758 74.93900000000764 71.41900000000727 71.33800000000726 71.14800000000724 72.09600000000734 74.79300000000762 90.36500000000927 75.75100000000774 77.00700000000786 78.52700000000803 79.2870000000081 73.50300000000749 71.6360000000073 70.99200000000722 80.38000000000822 71.76300000000731 74.19800000000757 76.26500000000779 85.93500000000881 87.07000000000893 79.1870000000081 88.25600000000905 74.19800000000757 71.30700000000726 75.57900000000771 76.90200000000785 77.81200000000794 77.53100000000792 79.09900000000809 83.14800000000851 92.70800000000952 70.7620000000072 71.11300000000723 71.46700000000727 75.06700000000765 70.8010000000072 73.14300000000745 74.64600000000762 76.66800000000782 75.40800000000769 81.65700000000835 81.91500000000838 71.74200000000731 94.70000000000974 71.09700000000724 73.15100000000746 77.42800000000791 77.18600000000788 79.31100000000811 84.60000000000866 99.91000000001029 79.11700000000809 71.39400000000727 71.10500000000724 72.09800000000735 80.39500000000822 83.53500000000855 82.32700000000843 76.09300000000776 80.2720000000082 84.60000000000866 85.71400000000878 71.45000000000728 71.03800000000723 71.76300000000731 74.06900000000755 75.92100000000775 76.26000000000778 76.09300000000776 102.39300000001055 81.99400000000838 84.8760000000087 71.70000000000731 71.70000000000731 75.23400000000767 70.8540000000072 82.41100000000843 72.16200000000735 83.77800000000857 78.02700000000797 74.93900000000764 83.49400000000855 86.91500000000892 84.86400000000869 70.8540000000072 75.92100000000775 80.05600000000818 73.50300000000749 87.41500000000896 82.70500000000847 88.6860000000091 71.82100000000732 71.87800000000732 77.64100000000794 79.86900000000817 74.33900000000757 74.24300000000757 78.46500000000802 87.07200000000893 78.09800000000797 79.17300000000809 89.39400000000917 71.87800000000732 71.82100000000732 75.89000000000775 76.82300000000784 81.80900000000837 82.60700000000845 87.82800000000901 92.17300000000947 94.91100000000976 71.14600000000725 73.7090000000075 76.73100000000784 71.26200000000725 80.01300000000818 73.17000000000746 84.23100000000862 77.03300000000786 78.96700000000807 76.4490000000078 83.72500000000858 71.62500000000729 72.19900000000736 73.09800000000745 74.99800000000765 75.85300000000774 81.05100000000829 83.27400000000853 87.15400000000893 92.21600000000947 71.56000000000729 71.40200000000726 72.08700000000734 75.31500000000769 78.92700000000806 75.00800000000766 74.84100000000764 78.06900000000797 74.88800000000764 76.26300000000778 79.65500000000814 81.53800000000834 73.5880000000075 71.52400000000728 75.33300000000769 78.01800000000797 73.7090000000075 81.27100000000831 81.31300000000832 85.51500000000877 75.00800000000766 71.32000000000725 78.67900000000805 80.65500000000824 78.43700000000801 78.262000000008 76.63600000000783 84.49600000000865 85.9020000000088 77.01000000000786 76.07600000000777 80.83000000000827 79.82800000000816 71.60000000000728 71.28300000000726 71.34100000000726 90.5870000000093 74.20200000000756 80.66700000000824 93.76000000000964 75.31000000000768 74.85800000000764 74.99800000000765 79.67900000000814 80.72200000000825 72.10700000000735 84.26000000000863 74.84100000000764 71.35500000000727 80.39900000000821 71.40200000000726 83.0380000000085 76.26300000000778 84.62200000000867 78.12400000000798 71.23100000000726 71.82100000000732 82.34600000000843 89.28500000000916 103.72900000001069 71.94500000000733 71.53800000000729 72.27000000000736 72.76900000000741 72.6560000000074 73.34100000000747 77.70000000000793 78.02000000000797 81.34000000000832 82.96000000000849 83.0390000000085 86.11900000000882 76.77500000000784 80.42500000000823 81.53000000000834 84.8730000000087 85.10400000000872 87.93700000000902 90.27300000000926 92.96000000000956 75.23600000000768 75.3980000000077 79.46200000000812 75.23400000000767 77.96000000000797 78.78600000000804 82.95700000000849 84.39900000000864 71.47800000000727 85.50800000000876 79.07400000000808 87.42400000000896 88.90800000000912 88.14600000000904 75.56100000000771 79.04100000000808 76.58200000000782 81.56100000000835 89.88200000000923 95.57400000000983 75.07400000000766 71.93600000000733 81.19000000000831 74.38900000000758 76.66800000000782 82.33000000000843 83.26100000000852 75.23600000000768 77.61200000000792 80.25500000000821 74.38900000000758 87.734000000009 74.06000000000755 75.08600000000766 82.05800000000839 79.99900000000818 88.51000000000909 72.32800000000736 81.54500000000834 80.62700000000825 71.88200000000732 79.71900000000815 72.09600000000734 71.54600000000728 78.18700000000798 77.2840000000079 78.53000000000803 84.49400000000865 76.58200000000782 79.89900000000817 83.58400000000856 86.47900000000887 76.58200000000782 80.75700000000826 95.92600000000986 91.02200000000934 83.11000000000851 91.24000000000937 99.63200000001025 76.3890000000078 100.10000000001031 74.79300000000762 71.36000000000726 77.78100000000795 86.98000000000891 83.67800000000857 74.5300000000076 86.61300000000888 75.56100000000771 71.24100000000725 75.23800000000767 72.09600000000734 78.85400000000806 79.72800000000815 80.79300000000826 85.44000000000875 76.66800000000782 81.33700000000832 88.7240000000091 99.9870000000103 74.84100000000764 73.27500000000747 73.32600000000747 78.23800000000799 76.4490000000078 78.76200000000804 80.49000000000824 91.91500000000944 93.89300000000965 88.23100000000905 72.26000000000737 72.01800000000733 72.78000000000742 90.45800000000929 72.31700000000737 72.87500000000742 78.77700000000804 81.69600000000835 84.9470000000087 84.8150000000087 76.07600000000777 74.4750000000076 75.15100000000767 77.58200000000792 83.52100000000856 96.59500000000993 96.2530000000099 98.79500000001016 88.07000000000903 72.36700000000737 72.78000000000742 76.20500000000777 79.05300000000808 81.69000000000835 79.38100000000811 84.62100000000866 86.92400000000892 90.20200000000926 135.7869999997947 133.35199999982666 77.46100000000791 73.27500000000747 73.83000000000753 72.28100000000737 74.5050000000076 81.07000000000829 81.32600000000832 80.13200000000819 90.26700000000926 86.03600000000881 95.19500000000978 104.60200000001079 77.88200000000795 79.30900000000811 84.99700000000871 108.66600000001121 94.85100000000975 100.78800000001038 102.0130000000105 101.86700000001049 76.82100000000784 72.58100000000739 77.3380000000079 77.3380000000079 72.42000000000738 77.88200000000795 79.66200000000815 76.38200000000779 76.61900000000782 77.82500000000795 81.1010000000083 81.60600000000835 96.76300000000995 88.14600000000904 77.45700000000791 75.70400000000772 87.52600000000898 85.66300000000878 88.66000000000909 71.80900000000732 78.06100000000798 120.28899999999817 87.38800000000896 109.4520000000113 84.31600000000864 85.63100000000877 90.5930000000093 77.83900000000796 75.31000000000768 82.9950000000085 83.0670000000085 72.26000000000737 77.16000000000788 72.26000000000737 83.78600000000858 78.77400000000804 82.44000000000844 89.87100000000922 86.25500000000883 84.85600000000869 72.43600000000738 72.38300000000737 75.56100000000771 80.54800000000824 80.49300000000824 82.01300000000839 82.84200000000848 83.74800000000857 85.34500000000874 85.71900000000879 86.50500000000886 86.75200000000889 77.84600000000795 78.50900000000802 80.03400000000818 81.1280000000083 82.97800000000849 84.8670000000087 84.79500000000868 96.1980000000099 73.6190000000075 77.07800000000788 79.1980000000081 77.3540000000079 82.85400000000848 83.91500000000859 72.43600000000738 74.5300000000076 93.51400000000962 79.96200000000817 73.74200000000752 76.3890000000078 76.58200000000782 84.24100000000863 81.62100000000835 92.38200000000948 87.19800000000895 98.39900000001013 99.9360000000103 75.07400000000766 74.38900000000758 74.75100000000762 84.74700000000868 83.64900000000857 94.88700000000975 72.29300000000737 93.75600000000964 73.11500000000746 79.39000000000811 75.72300000000773 78.38700000000802 77.54800000000792 79.39000000000811 82.46200000000844 89.88400000000922 84.9280000000087 84.9180000000087 72.91500000000742 84.9160000000087 89.6340000000092 74.67000000000762 79.2250000000081 74.75100000000762 74.6080000000076 78.44300000000801 86.51400000000886 86.42500000000886 77.48900000000792 74.6080000000076 76.46300000000781 79.1870000000081 85.9060000000088 77.3950000000079 80.03900000000819 77.49000000000791 84.61500000000866 93.45600000000961 77.58200000000792 76.96700000000786 84.72200000000868 73.12000000000745 78.04700000000797 72.18600000000735 87.787000000009 86.8730000000089 76.09300000000776 79.21800000000809 80.46900000000822 81.94800000000839 72.01900000000734 85.31100000000875 73.21500000000746 86.13500000000883 81.43300000000833 99.33300000001023 97.92300000001008 90.85600000000933 88.97000000000912 82.21400000000841 75.85300000000774 78.09600000000798 80.54300000000823 79.06400000000808 79.86500000000817 81.23400000000831 84.03200000000861 84.22800000000862 84.25900000000863 84.33600000000864 85.22600000000874 86.15600000000883 75.00800000000766 76.02900000000776 78.79800000000805 79.59700000000814 83.58200000000856 87.00300000000892 89.5750000000092 110.4420000000114 74.90100000000764 73.88000000000753 76.55800000000781 75.00800000000766 81.74100000000837 78.68100000000804 87.10400000000894 89.17900000000915 91.25800000000937 73.37900000000748 73.06500000000744 73.88000000000753 73.99600000000754 95.16900000000979 78.09600000000798 76.82100000000784 80.40200000000821 83.46300000000855 103.18500000001063 83.0960000000085 79.44500000000812 79.08900000000808 78.309000000008 80.68500000000826 73.37900000000748 91.65300000000941 76.55800000000781 75.85300000000774 81.46500000000833 79.69500000000815 79.70900000000815 79.55800000000814 79.69300000000814 78.75700000000805 79.59700000000814 79.06400000000808 96.44400000000992 84.63600000000866 94.3640000000097 89.90500000000922 75.31000000000768 75.85300000000774 77.03300000000786 75.00800000000766 85.54300000000876 73.06500000000744 90.73000000000931 76.82100000000784 77.45700000000791 73.37900000000748 84.04700000000861 76.20500000000777 85.99900000000882 78.09600000000798 77.67000000000793 94.98600000000977 82.88700000000848 84.0790000000086 86.41300000000886 73.71800000000752 82.0840000000084 73.18100000000746 75.32600000000768 78.53200000000803 74.63700000000762 84.27300000000864 77.24500000000789 78.309000000008 89.16900000000915 79.59700000000814 92.4300000000095 73.29800000000746 83.41500000000855 75.85300000000774 76.82100000000784 90.06300000000924 81.66900000000835 85.93400000000881 84.64900000000867 103.32600000001065 73.21500000000746 75.56100000000771 75.3980000000077 75.72300000000773 74.23600000000756 75.56100000000771 77.11200000000787 79.00200000000807 82.82000000000848 82.24000000000842 85.66300000000878 72.41800000000738 73.74200000000752 75.3980000000077 75.3980000000077 76.19800000000778 89.08000000000914 78.05400000000797 85.49700000000877 91.32800000000938 72.51800000000739 73.12000000000745 74.67000000000762 73.86500000000753 74.11000000000756 73.45100000000748 75.81400000000774 76.00500000000775 74.5300000000076 74.67000000000762 78.29000000000799 83.74700000000857 75.23600000000768 74.81100000000762 73.01900000000744 74.67000000000762 73.6190000000075 78.76400000000805 77.81800000000794 85.9000000000088 73.34100000000747 75.88600000000774 77.3380000000079 75.3980000000077 73.34100000000747 73.34100000000747 74.91200000000764 74.11000000000756 75.23300000000768 74.5300000000076 77.81800000000794 78.52700000000803 75.56100000000771 74.38900000000758 76.77500000000784 77.58200000000792 74.81100000000762 74.67000000000762 75.72300000000773 78.52700000000803 72.47300000000739 76.58200000000782 77.16100000000787 73.01000000000744 74.91200000000764 73.45100000000748 75.56100000000771 78.29000000000799 87.658000000009 77.3540000000079 78.29000000000799 72.77200000000741 75.3980000000077 74.75100000000762 74.38900000000758 73.6190000000075 76.19800000000778 73.37200000000747 72.91500000000742 84.85200000000869 75.23600000000768 72.52000000000739 76.3890000000078 75.81400000000774 73.5140000000075 76.77500000000784 72.38300000000737 73.86500000000753 73.86500000000753 73.23100000000747 76.3890000000078 75.23600000000768 87.14500000000893 84.9180000000087 72.6170000000074 90.69700000000931 74.38900000000758 75.56100000000771 76.58200000000782 84.05300000000861];
targetV=0.1;
targetW=0.1;


energySum = 0;

for sTIndex = 1:length(sTs)
for V=VMin:VDelta:VMax
    for W=WMin:WDelta:WMax
       %%%% average power for charge up stage
		%lowChargePwr = ((((N-1)*(V-W)^2)/Rap) + V^2/Rdw) + (N * (Dc/(Rap+((N-1)*Rdw))));
		%highChargePwr = ((((N-1)*(V+W)^2)/Rap) + V^2/Rdw)+ (N * (Dc/(Rp+((N-1)*Rdw))));
		oldLowChargePwr =  N*((V^2/Rdw)+(N-1)*((V-W)^2/Rdw) + (Dc^2/((Rap+Rdw/(N-1)))));
		oldHighChargePwr = N*((V^2/Rdw)+(N-1)*((V+W)^2/Rdw) + (Dc^2/((Rp+ Rdw/(N-1)))));
        
        lowChargePwr  = N*((V^2/Rdw)+(N-1)*(0^2/Rp ) + (Dc^2/((Rp +Rdw/(N-1)))));
        highChargePwr = N*((V^2/Rdw)+(N-1)*(0^2/Rap) + (Dc^2/((Rap+Rdw/(N-1)))));
				
		chargePwr=(lowChargePwr+highChargePwr)/2;
		
        %chargePwr = N*((V^2/Rdw)+(N-1)*(V^2/Rdw) + (Dc^2/((Rp+Rdw/(N-1)))));
	
		%%%% weighted average for input half during operation
		warning('off', 'MATLAB:nchoosek:LargeCoefficient');
		nm=N-1;
		lowTotalInput = 2/(2^nm) * W^2/(Rdw+Rap/(N-1));
		for c= 1:nm-1
		    A=Rap/c;
		    B=Rap/(nm-c);
		    S=A*B+B*Rdw+A*Rdw;
		    P=((W^2)/S)*(A+B+4*Rdw);
		    prob = nchoosek(nm,c)/(2^nm);
		    lowTotalInput=lowTotalInput+P*prob;
		end
		
		highTotalInput = 2/(2^nm) * W^2/(Rdw+Rp/(N-1));
		for c= 1:nm-1
		    A=Rp/c;
		    B=Rp/(nm-c);
		    S=A*B+B*Rdw+A*Rdw;
		    P=((W^2)/S)*(A+B+4*Rdw);
		    prob = nchoosek(nm,c)/(2^nm);
		    highTotalInput=highTotalInput+P*prob;
		end
		
		totalInput = (lowTotalInput+highTotalInput)/2;

        %%%%%%%%%%% average for output half during operation
		lowOutput  = Dc^2/(Rap+(Rdw/(N-1)));
		highOutput = Dc^2/( Rp+(Rdw/(N-1)));
		output = (lowOutput+highOutput)/2;
		
		%%% average power for operation
		operatingPwr = N*(totalInput + output);
		
		%time for node to reach right side of track
		t1=Mr/((k*V/(NegR+Rdw))+LNode);
		
		%time for connections
		tCon=(L)/(k*(Dc/(Rp+Rdw/(N-1))*(1/(N-1)))+LSyn)+t1;
		
		%200 ns power
		%pwr=(tCon*chargePwr + (200*nano-tCon)*operatingPwr)/(200*nano); 
		%pwr=(tCon*chargePwr + (81*nano-tCon)*operatingPwr)/(81*nano); 
 		
        stopTime=sTs(sTIndex);
        pwr=(tCon*chargePwr + (stopTime*nano-tCon)*operatingPwr)/(stopTime*nano); 
        %disp("V: "+V+" tConn: "+ tCon+" E: "+ (tCon*chargePwr))
        
        z(round((V-VMin)/VDelta)+1,round((W-WMin)/WDelta)+1)=pwr;
        if(V<targetV+0.001 && V>targetV-0.001 && W<targetW+0.001 && W>targetW-0.001)
            energySum = energySum + (pwr*stopTime);
            %disp(stopTime);
            disp(pwr*stopTime)
            pwr2=pwr;
            %plot3(0.1,0.25,pwr);
        end
    end
end
end
disp(energySum)
disp(sum(sTs))
disp(energySum/sum(sTs))

if false
    fh= figure;
    h=gca;
    SERF=surf(y,x,z);
    hold on
    %dcm=datacursormode(fh);
    %set(dcm,'updatefcn',@myfunction);


    %id=sub2ind(size(z),21,10);
    %tip= datatip(SERF,'DataIndex',id);
    %datatip(SERF,0.1,0.25,pwr2);
    %plot3(0.1,0.25,pwr2*1.0,'.r','markersize',30);
    %h.YLim=[0,40];
    %h.YTick=[0:0.1:0.4];
    ylabel('Input (V)');
    xlabel('Weight (V)');
    zlabel('Power (W)');
    ax = gca;
    grid on
    %grid minor
    ax.XAxis.FontSize = 16;
    ax.YAxis.FontSize = 16;
    ax.ZAxis.FontSize = 16;
    ax.LineWidth=2;

    height = 480;
    set(gcf,'position',[10,10,height*4/3,height])
    hold off
    print(gcf,'foo.png','-dpng','-r500');
end
%set(h,'zscale','log')